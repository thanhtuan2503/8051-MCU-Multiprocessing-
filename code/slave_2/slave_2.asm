
SLAV_2 EQU 32H
ORG 0000H
LJMP MAIN

ORG 0030H
MAIN: 
    MOV TMOD, #20H
    MOV TL1, #-3
    MOV TH1, #-3
    MOV SCON, #0D2H
	SETB TR1
    SETB TB8
    MOV P1, #0FFH
    MOV P2, #0FFH
    CLR F0
N_COM:
    CLR SM2
COM:
    ACALL THU
    JB RB8, DT
CHECK:
    CJNE A, #SLAV_2, MUT
    SETB SM2
    MOV A, #SLAV_2
    ACALL PHAT
DT: 
	JNB SM2, MUT
    CLR SM2
	ACALL THU
    JNB RB8, CHECK
    SETB SM2
    MOV P2, A
    JZ N_COM			;THU DATA

	SETB P3.4
	ACALL DLS120
	SETB P3.7
	NOP
    MOV A, P0
	ACALL TINH_BCD
	MOV A,30H
	ACALL PHAT		   ;PHAT DATA

	
	MOV A,31H
	ACALL PHAT

//	ACALL DLS120
	CLR P3.4
	CLR P3.7
    SJMP DT
MUT:
    MOV A, P1
    MOV P2, A
    SJMP COM

PHAT:
    JNB TI,$
    CLR TI
    MOV SBUF,A
    RET

THU:
    JNB RI,$
    MOV A,SBUF
    CLR RI
    RET
DLS120:
	MOV R7,#60
	DJNZ R7,$
	RET
DLS1M:
	MOV R7,#2
LP:	MOV R6,#250
	DJNZ R6,$
	DJNZ R7,LP

TINH_BCD:
MOV B,#10
DIV AB
MOV 30H,A
MOV 31H,B
RET

END